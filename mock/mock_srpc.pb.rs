// Code generated by protoc-gen-starpc-rust. DO NOT EDIT.
// protoc-gen-starpc-rust version: v0.45.1-0.20260203090429-3e915608d4e8
// source: github.com/aperturerobotics/starpc/mock/mock.proto

#[allow(unused_imports)]
use starpc::StreamExt;

/// Service ID for Mock.
pub const MOCK_SERVICE_ID: &str = "e2e.mock.Mock";

/// Client trait for Mock.
#[starpc::async_trait]
pub trait MockClient: Send + Sync {
    /// MockRequest.
    async fn mock_request(&self, request: &MockMsg) -> starpc::Result<MockMsg>;
}

/// Client implementation for Mock.
pub struct MockClientImpl<C> {
    client: C,
}

impl<C: starpc::Client> MockClientImpl<C> {
    /// Creates a new client.
    pub fn new(client: C) -> Self {
        Self { client }
    }
}

#[starpc::async_trait]
impl<C: starpc::Client + 'static> MockClient for MockClientImpl<C> {
    async fn mock_request(&self, request: &MockMsg) -> starpc::Result<MockMsg> {
        self.client.exec_call("e2e.mock.Mock", "MockRequest", request).await
    }
}

/// Server trait for Mock.
#[starpc::async_trait]
pub trait MockServer: Send + Sync {
    /// MockRequest.
    async fn mock_request(&self, request: MockMsg) -> starpc::Result<MockMsg>;
}

const MOCK_METHOD_IDS: &[&str] = &[
    "MockRequest",
];

/// Handler for Mock.
pub struct MockHandler<S: MockServer> {
    server: std::sync::Arc<S>,
}

impl<S: MockServer + 'static> MockHandler<S> {
    /// Creates a new handler wrapping the server implementation.
    pub fn new(server: S) -> Self {
        Self { server: std::sync::Arc::new(server) }
    }

    /// Creates a new handler with a shared server.
    pub fn with_arc(server: std::sync::Arc<S>) -> Self {
        Self { server }
    }
}

#[starpc::async_trait]
impl<S: MockServer + 'static> starpc::Invoker for MockHandler<S> {
    async fn invoke_method(
        &self,
        _service_id: &str,
        method_id: &str,
        stream: Box<dyn starpc::Stream>,
    ) -> (bool, starpc::Result<()>) {
        match method_id {
            "MockRequest" => {
                let request: MockMsg = match stream.msg_recv().await {
                    Ok(r) => r,
                    Err(e) => return (true, Err(e)),
                };
                match self.server.mock_request(request).await {
                    Ok(response) => {
                        if let Err(e) = stream.msg_send(&response).await {
                            return (true, Err(e));
                        }
                        (true, Ok(()))
                    }
                    Err(e) => (true, Err(e)),
                }
            }
            _ => (false, Err(starpc::Error::Unimplemented)),
        }
    }
}

impl<S: MockServer + 'static> starpc::Handler for MockHandler<S> {
    fn service_id(&self) -> &'static str {
        "e2e.mock.Mock"
    }

    fn method_ids(&self) -> &'static [&'static str] {
        MOCK_METHOD_IDS
    }
}

